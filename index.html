<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TIENDA DE ZAPATILLAZ BONEY JARWES</title>
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <style>
.pedido-card {
  border: 1px solid #ddd;
  background: #fff;
  border-radius: 10px;
  padding: 15px;
  margin-bottom: 20px;
}

.pedido-header {
  font-size: 18px;
  font-weight: bold;
  margin-bottom: 10px;
}

.pedido-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
  border-bottom: 1px solid #eee;
}

.pedido-item:last-child {
  border: none;
}

.pedido-item img {
  width: 60px;
  height: 60px;
  border-radius: 8px;
  margin-right: 12px;
}

#alertaAgregado {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 2000;
  display: none;
  padding: 10px 14px;
  border-radius: 6px;
  font-weight: 600;
  box-shadow: 0 4px 10px rgba(0,0,0,.15);
  background-color: green;
  color: white;
}

.pedido-item { border-bottom: 1px solid #e9ecef; padding: 10px 0; }
  </style>
</head>

<body>

<div id="alertaAgregado" class="alert alert-success">El PRODUCTO SE A AGREGA CORRECTAMENTE </div>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand fw-bold" href="#">tienda online</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#menu">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="menu">
      <ul class="navbar-nav ms-auto align-items-center">
        <li class="nav-item" id="loginItem">
          <button class="btn btn-outline-light" data-bs-toggle="modal" data-bs-target="#authModal">
            Iniciar sesi贸n / Registrarse
          </button>
        </li>
      </ul>
    </div>
  </div>
</nav>

<!-- HEADER -->
<header class="bg-primary text-white text-center py-5">
  <div class="container">
    <h1 class="display-4">Bienvenido a tienda online</h1>
    <p class="lead">Tu tienda de confianza al mejor precio</p>
  </div>
</header>

<!-- PRODUCTOS -->
<section class="py-5">
  <div class="container">
    <h2 class="text-center mb-4">NUESTROS PRODUCTOS A UN BUEN PRECIO</h2>
    <div class="row g-4">

      <!-- PRODUCTOS -->
      <div class="col-12 col-sm-6 col-md-3">
        <div class="card h-80 shadow-sm">
          <img src="img/1.jpeg" class="card-img-top" alt="camisa">
          <div class="card-body text-center">
            <h5 class="card-title">camisa</h5>
            <p class="card-text">para hombre</p>
            <p class="fw-bold">s/30.00</p>
            <button class="btn btn-primary addToCart">AGREGAR AL CARRITO</button>
          </div>
        </div>
      </div>

      <div class="col-12 col-sm-6 col-md-3">
        <div class="card h-80 shadow-sm">
          <img src="img/2.jpeg" class="card-img-top" alt="zapatillas">
          <div class="card-body text-center">
            <h5 class="card-title">zapatillas</h5>
            <p class="card-text">zapatillas deportivas</p>
            <p class="fw-bold">s/35.00</p>
            <button class="btn btn-primary addToCart">AGREGAR AL CARRITO</button>
          </div>
        </div>
      </div>

      <div class="col-12 col-sm-6 col-md-3">
        <div class="card h-80 shadow-sm">
          <img src="img/3.jpeg" class="card-img-top" alt="zapatillas">
          <div class="card-body text-center">
            <h5 class="card-title">zapatillas</h5>
            <p class="card-text">zapatillas deportivas</p>
            <p class="fw-bold">s/25.00</p>
            <button class="btn btn-primary addToCart">AGREGAR AL CARRITO</button>
          </div>
        </div>
      </div>

      <div class="col-12 col-sm-6 col-md-3">
        <div class="card h-80 shadow-sm">
          <img src="img/4.jpeg" class="card-img-top" alt="zapatillas">
          <div class="card-body text-center">
            <h5 class="card-title">zapatillas</h5>
            <p class="card-text">zapatillas deportivas</p>
            <p class="fw-bold">s/40.00</p>
            <button class="btn btn-primary addToCart">AGREGAR AL CARRITO</button>
          </div>
        </div>
      </div>

      <div class="col-12 col-sm-6 col-md-3">
        <div class="card h-80 shadow-sm">
          <img src="img/5.jpeg" class="card-img-top" alt="zapatillas">
          <div class="card-body text-center">
            <h5 class="card-title">zapatillas</h5>
            <p class="card-text">zapatillas deportivas</p>
            <p class="fw-bold">s/35.00</p>
            <button class="btn btn-primary addToCart">AGREGAR AL CARRITO</button>
          </div>
        </div>
      </div>

      <div class="col-12 col-sm-6 col-md-3">
        <div class="card h-80 shadow-sm">
          <img src="img/6.jpeg" class="card-img-top" alt="zapatillas">
          <div class="card-body text-center">
            <h5 class="card-title">zapatillas</h5>
            <p class="card-text">zapatillas deportivas</p>
            <p class="fw-bold">s/35.00</p>
            <button class="btn btn-primary addToCart">AGREGAR AL CARRITO</button>
          </div>
        </div>
      </div>

      <div class="col-12 col-sm-6 col-md-3">
        <div class="card h-80 shadow-sm">
          <img src="img/7.jpeg" class="card-img-top" alt="zapatillas">
          <div class="card-body text-center">
            <h5 class="card-title">zapatillas</h5>
            <p class="card-text">zapatillas deportivas</p>
            <p class="fw-bold">s/35.00</p>
            <button class="btn btn-primary addToCart">AGREGAR AL CARRITO</button>
          </div>
        </div>
      </div>

      <div class="col-12 col-sm-6 col-md-3">
        <div class="card h-80 shadow-sm">
          <img src="img/8.jpeg" class="card-img-top" alt="zapatillas">
          <div class="card-body text-center">
            <h5 class="card-title">zapatillas</h5>
            <p class="card-text">zapatillas deportivas</p>
            <p class="fw-bold">s/35.00</p>
            <button class="btn btn-primary addToCart">AGREGAR AL CARRITO</button>
          </div>
        </div>
      </div>

    </div>
  </div>
</section>

<!-- MODAL LOGIN/REGISTRO -->
<div class="modal fade" id="authModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-dark text-white">
        <h5 class="modal-title">Acceder a tu cuenta</h5>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <ul class="nav nav-tabs mb-3">
          <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#loginTab">Iniciar Sesi贸n</button></li>
          <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#registerTab">Registrarse</button></li>
        </ul>

        <div class="tab-content">
          <div class="tab-pane fade show active" id="loginTab">
            <div class="d-grid mb-3">
              <button id="googleLogin" class="btn btn-danger">
                <i class="bi bi-google"></i> Iniciar sesi贸n con Google
              </button>
            </div>

            <form id="formlogin">
              <div class="mb-3"><label>Email</label><input type="email" id="loginEmail" class="form-control" required></div>
              <div class="mb-3"><label>Contrase帽a</label><input type="password" id="loginPassword" class="form-control" required minlength="6"></div>
              <button class="btn btn-primary w-100">Iniciar Sesi贸n</button>
            </form>
          </div>

          <div class="tab-pane fade" id="registerTab">
            <form id="formRegister">
              <div class="mb-3"><label>Nombre completo</label><input type="text" id="regNombre" class="form-control" required></div>
              <div class="mb-3"><label>Email</label><input type="email" id="regEmail" class="form-control" required></div>
              <div class="mb-3"><label>Contrase帽a</label><input type="password" id="regPassword" class="form-control" required minlength="6"></div>
              <button class="btn btn-primary w-100">Registrarse</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- MODAL CARRITO -->
<div class="modal fade" id="modalCarrito" tabindex="-1">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header bg-dark text-white">
        <h5 class="modal-title"> Tu carrito</h5>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="listaCarrito"></div>
      <div class="modal-footer d-flex justify-content-between">
        <h5 class="m-0">Total: <span id="totalCarrito" class="fw-bold">S/ 0.00</span></h5>
        <button class="btn btn-success" id="btnComprar">Pagar</button>
      </div>
    </div>
  </div>
</div>

<!-- MODAL MIS PEDIDOS -->
<div class="modal fade" id="modalPedidos" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header bg-dark text-white">
        <h5 class="modal-title"> Mis pedidos</h5>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div id="listaPedidos"></div>
      </div>
    </div>
  </div>
</div>

<!-- FOOTER -->
<footer class="bg-dark text-white text-center py-3 mt-5">
  <p class="mb-0">&copy; BONEY JARWES 2025</p>
</footer>

<!-- BOOTSTRAP JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>


  <!-- ================== CARRITO ================== -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, query, where, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDBM97jFiC31LlofM_YOJY2l20YqAkxYWc",
  authDomain: "casa-zapatillas.firebaseapp.com",
  projectId: "casa-zapatillas",
  storageBucket: "casa-zapatillas.appspot.com",
  messagingSenderId: "912547598774",
  appId: "1:912547598774:web:28f3708a71561f3c62b117",
  measurementId: "G-TGGF3N8RTD"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let carrito = JSON.parse(localStorage.getItem("carrito")) || [];

function actualizarContador() {
  const contador = document.getElementById("contadorCarrito");
  if (contador) contador.textContent = carrito.length;
}

function renderCarrito() {
  const lista = document.getElementById("listaCarrito");
  lista.innerHTML = "";
  let total = 0;

  carrito.forEach((p, i) => {
    total += p.precio;
    const div = document.createElement("div");
    div.className = "d-flex justify-content-between align-items-center border-bottom py-2";
    div.innerHTML = `
      <div class="d-flex align-items-center">
        <img src="${p.img}" width="50" height="50" class="me-2 rounded">
        <span>${p.nombre}</span>
      </div>
      <div class="d-flex align-items-center">
        <span class="fw-bold me-3">S/ ${p.precio}</span>
        <button class="btn btn-sm btn-danger btn-eliminar" data-index="${i}"><i class="bi bi-trash"></i></button>
      </div>
    `;
    lista.appendChild(div);
  });

  document.getElementById("totalCarrito").textContent = "S/ " + total.toFixed(2);

  // Agregar eventos a botones de eliminar
  document.querySelectorAll(".btn-eliminar").forEach(btn => {
    btn.addEventListener("click", e => {
      const idx = parseInt(btn.dataset.index);
      carrito.splice(idx, 1);
      localStorage.setItem("carrito", JSON.stringify(carrito));
      renderCarrito();
      actualizarContador();
    });
  });
}

/* AGREGAR PRODUCTOS */
document.querySelectorAll(".addToCart").forEach((btn) => {
  btn.addEventListener("click", () => {
    const card = btn.closest(".card");
    const nombre = card.querySelector(".card-title").textContent;
    const precio = parseFloat(card.querySelector(".fw-bold").textContent.replace("s/", "").trim());
    const img = card.querySelector("img").src;

    carrito.push({ nombre, precio, img });
    localStorage.setItem("carrito", JSON.stringify(carrito));
    renderCarrito();
    actualizarContador();

    document.getElementById("alertaAgregado").style.display = "block";
    setTimeout(() => document.getElementById("alertaAgregado").style.display = "none", 1500);
  });
});

/* BOTON PAGAR */
document.getElementById("btnComprar").addEventListener("click", async () => {
  const user = auth.currentUser;
  if (!user) {
    alert("Debes iniciar sesi贸n para realizar la compra");
    return;
  }

  if (carrito.length === 0) {
    alert("Tu carrito est谩 vac铆o");
    return;
  }

  try {
    await addDoc(collection(db, "pedidos"), {
      uid: user.uid,
      items: carrito,
      total: carrito.reduce((a,b)=>a+b.precio,0),
      fecha: serverTimestamp()
    });

    carrito = [];
    localStorage.setItem("carrito", JSON.stringify(carrito));
    renderCarrito();
    actualizarContador();

    alert("Pedido realizado con 茅xito ");
    const modalCarrito = bootstrap.Modal.getInstance(document.getElementById("modalCarrito"));
    if (modalCarrito) modalCarrito.hide();
  } catch (err) {
    console.error(err);
    alert("Ocurri贸 un error al realizar la compra");
  }
});

/* CARGAR PEDIDOS USUARIO */
async function cargarPedidosUsuario() {
  const user = auth.currentUser;
  if (!user) {
    alert("Debes iniciar sesi贸n para ver tus pedidos");
    return;
  }

  const q = query(collection(db, "pedidos"), where("uid", "==", user.uid));
  const querySnapshot = await getDocs(q);
  const lista = document.getElementById("listaPedidos");
  lista.innerHTML = "";

  if (querySnapshot.empty) {
    lista.innerHTML = "<p>No tienes pedidos a煤n</p>";
    return;
  }

  querySnapshot.forEach(docu => {
    const data = docu.data();
    const div = document.createElement("div");
    div.className = "pedido-card";
    div.innerHTML = `
      <div class="pedido-header">Pedido #${docu.id}</div>
      ${data.items.map(item => `
        <div class="pedido-item">
          <div class="d-flex align-items-center">
            <img src="${item.img}">
            <span>${item.nombre}</span>
          </div>
          <span>S/ ${item.precio}</span>
        </div>
      `).join('')}
      <div class="fw-bold mt-2">Total: S/ ${data.total.toFixed(2)}</div>
    `;
    lista.appendChild(div);
  });
}

/* ESTADO DE AUTENTICACION */
onAuthStateChanged(auth, user => {
  actualizarContador();
});
document.addEventListener("DOMContentLoaded", () => {
  renderCarrito();
  actualizarContador();
});
</script>

</body>
</html>
