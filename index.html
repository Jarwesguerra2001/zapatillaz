<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TIENDA DE ZAPATILLAS BONEY JARWES</title>
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    /* ===== PEDIDOS ===== */
    .pedido-card { border: 1px solid #ddd; background: #fff; border-radius: 10px; padding: 15px; margin-bottom: 20px; }
    .pedido-header { font-size: 18px; font-weight: bold; margin-bottom: 10px; }
    .pedido-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #eee; }
    .pedido-item:last-child { border-bottom: none; }
    .pedido-item img { width: 60px; height: 60px; border-radius: 8px; margin-right: 12px; }

    /* ===== ALERTA ===== */
    #alertaAgregado {
      position: fixed; top: 20px; right: 20px; z-index: 2000;
      display: none; padding: 10px 14px; border-radius: 6px;
      font-weight: 600; box-shadow: 0 4px 10px rgba(0,0,0,.15); color: white;
    }

    /* ===== HEADER MEJORADO ===== */
    header {
      background: linear-gradient(135deg, #4f46e5, #3b82f6);
      color: white; text-align: center; padding: 60px 0;
    }
    header h1 { font-size: 2.5rem; font-weight: bold; }
    header p { font-size: 1.25rem; margin-top: 10px; }

    /* ===== PRODUCTOS ===== */
    .card { transition: transform .2s; cursor: pointer; }
    .card:hover { transform: scale(1.05); }
    .card-title { font-weight: 600; }
    .card-text { font-size: 0.9rem; }
    .fw-bold { font-weight: 700; }

    /* ===== CARRITO ===== */
    #listaCarrito div { margin-bottom: 10px; }
  </style>
</head>

<body>

<!-- ALERTA -->
<div id="alertaAgregado">
  <div id="msgAlerta"></div>
</div>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand fw-bold" href="#">TIENDA BONEY JARWES</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#menu">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="menu">
      <ul class="navbar-nav ms-auto align-items-center">
        <li class="nav-item" id="loginItem">
          <button class="btn btn-outline-light" data-bs-toggle="modal" data-bs-target="#authModal">
            Iniciar sesi칩n / Registrarse
          </button>
        </li>
      </ul>
    </div>
  </div>
</nav>

<!-- HEADER -->
<header>
  <div class="container">
    <h1>Bienvenido a la tienda de ZAPATILLAS BONEY JARWES</h1>
    <p>Calidad 칰nica y los mejores precios</p>
  </div>
</header>

<!-- PRODUCTOS -->
<section class="py-5">
  <div class="container">
    <h2 class="text-center mb-4">Nuestros productos Mejores Pedidos</h2>
    <div class="row g-4">
      <!-- PRODUCTO DE EJEMPLO -->
      <div class="col-12 col-sm-6 col-md-3">
        <div class="card h-100 shadow-sm">
          <img src="img/1.jpeg" class="card-img-top" alt="Zapatilla Nike">
          <div class="card-body text-center">
            <h5 class="card-title">Zapatillas Nike</h5>
            <p class="card-text">Para hombre</p>
            <p class="fw-bold" data-precio="100.00">S/ 100.00</p>
            <button class="btn btn-primary addToCart">AGREGAR AL CARRITO</button>
          </div>
        </div>
      </div>

            <!-- PRODUCTO DE EJEMPLO -->
      <div class="col-12 col-sm-6 col-md-3">
        <div class="card h-100 shadow-sm">
          <img src="img/2.jpeg" class="card-img-top" alt="Zapatilla Nike">
          <div class="card-body text-center">
            <h5 class="card-title">Zapatillas strike</h5>
            <p class="card-text">lujo unico</p>
            <p class="fw-bold" data-precio="270.00">S/270.00</p>
            <button class="btn btn-primary addToCart">AGREGAR AL CARRITO</button>
          </div>
        </div>
      </div>

            <!-- PRODUCTO DE EJEMPLO -->
      <div class="col-12 col-sm-6 col-md-3">
        <div class="card h-100 shadow-sm">
          <img src="img/3.jpeg" class="card-img-top" alt="Zapatilla Nike">
          <div class="card-body text-center">
            <h5 class="card-title">Zapatillas tigre</h5>
            <p class="card-text">mejor calidad en material</p>
            <p class="fw-bold" data-precio="50.00">S/ 50.00</p>
            <button class="btn btn-primary addToCart">AGREGAR AL CARRITO</button>
          </div>
        </div>
      </div>

            <!-- PRODUCTO DE EJEMPLO -->
      <div class="col-12 col-sm-6 col-md-3">
        <div class="card h-100 shadow-sm">
          <img src="img/4.jpeg" class="card-img-top" alt="Zapatilla Nike">
          <div class="card-body text-center">
            <h5 class="card-title">Zapatillas Puma</h5>
            <p class="card-text">nuevo modelo</p>
            <p class="fw-bold" data-precio="420.00">S/ 420.00</p>
            <button class="btn btn-primary addToCart">AGREGAR AL CARRITO</button>
          </div>
        </div>
      </div>

            <!-- PRODUCTO DE EJEMPLO -->
      <div class="col-12 col-sm-6 col-md-3">
        <div class="card h-100 shadow-sm">
          <img src="img/5.jpeg" class="card-img-top" alt="Zapatilla Nike">
          <div class="card-body text-center">
            <h5 class="card-title">Zapatillas Nike like</h5>
            <p class="card-text">puma moddelo nuevo</p>
            <p class="fw-bold" data-precio="150.00">S/ 150.00</p>
            <button class="btn btn-primary addToCart">AGREGAR AL CARRITO</button>
          </div>
        </div>
      </div>

            <!-- PRODUCTO DE EJEMPLO -->
      <div class="col-12 col-sm-6 col-md-3">
        <div class="card h-100 shadow-sm">
          <img src="img/6.jpeg" class="card-img-top" alt="Zapatilla Nike">
          <div class="card-body text-center">
            <h5 class="card-title">Zapatillas Puma like</h5>
            <p class="card-text"> mejor calidad</p>
            <p class="fw-bold" data-precio="200.00">S/ 200.00</p>
            <button class="btn btn-primary addToCart">AGREGAR AL CARRITO</button>
          </div>
        </div>
      </div>

            <!-- PRODUCTO DE EJEMPLO -->
      <div class="col-12 col-sm-6 col-md-3">
        <div class="card h-100 shadow-sm">
          <img src="img/7.jpeg" class="card-img-top" alt="Zapatilla Nike">
          <div class="card-body text-center">
            <h5 class="card-title">Zapatillas nuevo modelo</h5>
            <p class="card-text">Para hombre</p>
            <p class="fw-bold" data-precio="700.00">S/ 700.00</p>
            <button class="btn btn-primary addToCart">AGREGAR AL CARRITO</button>
          </div>
        </div>
      </div>

            <!-- PRODUCTO DE EJEMPLO -->
      <div class="col-12 col-sm-6 col-md-3">
        <div class="card h-100 shadow-sm">
          <img src="img/8.jpeg" class="card-img-top" alt="Zapatilla Nike">
          <div class="card-body text-center">
            <h5 class="card-title">Zapatillas oster like</h5>
            <p class="card-text">Para hombre</p>
            <p class="fw-bold" data-precio="500.00">S/ 500.00</p>
            <button class="btn btn-primary addToCart">AGREGAR AL CARRITO</button>
          </div>
        </div>
      </div>
      <!-- Agregar m치s productos similares -->
    </div>
  </div>
</section>

<!-- MODAL LOGIN/REGISTRO -->
<div class="modal fade" id="authModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-dark text-white">
        <h5 class="modal-title">Acceder a tu cuenta</h5>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <ul class="nav nav-tabs mb-3">
          <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#loginTab">Iniciar Sesi칩n</button></li>
          <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#registerTab">Registrarse</button></li>
        </ul>
        <div class="tab-content">
          <div class="tab-pane fade show active" id="loginTab">
            <div class="d-grid mb-3">
              <button id="googleLogin" class="btn btn-danger"><i class="bi bi-google"></i> Iniciar sesi칩n con Google</button>
            </div>
            <form id="formlogin">
              <div class="mb-3"><label>Email</label><input type="email" id="loginEmail" class="form-control" required></div>
              <div class="mb-3"><label>Contrase침a</label><input type="password" id="loginPassword" class="form-control" required minlength="6"></div>
              <button class="btn btn-primary w-100">Iniciar Sesi칩n</button>
            </form>
          </div>
          <div class="tab-pane fade" id="registerTab">
            <form id="formRegister">
              <div class="mb-3"><label>Nombre completo</label><input type="text" id="regNombre" class="form-control" required></div>
              <div class="mb-3"><label>Email</label><input type="email" id="regEmail" class="form-control" required></div>
              <div class="mb-3"><label>Contrase침a</label><input type="password" id="regPassword" class="form-control" required minlength="6"></div>
              <button class="btn btn-primary w-100">Registrarse</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- MODAL CARRITO -->
<div class="modal fade" id="modalCarrito" tabindex="-1">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header bg-dark text-white">
        <h5 class="modal-title">游 Tu carrito</h5>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="listaCarrito"></div>
      <div class="modal-footer d-flex justify-content-between">
        <h5 class="m-0">Total: <span id="totalCarrito" class="fw-bold">S/ 0.00</span></h5>
        <button class="btn btn-success" id="btnComprar">Pagar</button>
      </div>
    </div>
  </div>
</div>

<!-- MODAL MIS PEDIDOS -->
<div class="modal fade" id="modalPedidos" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header bg-dark text-white">
        <h5 class="modal-title">游닍 Mis pedidos</h5>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div id="listaPedidos"></div>
      </div>
    </div>
  </div>
</div>

<!-- FOOTER -->
<footer class="bg-dark text-white text-center py-3 mt-5">
  <p class="mb-0">&copy; BONEY JARWES 2025</p>
</footer>

<!-- BOOTSTRAP JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- FIREBASE SCRIPT -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
import { getFirestore, doc, setDoc, addDoc, collection, getDocs, query, where, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDBM97jFiC31LlofM_YOJY2l20YqAkxYWc",
  authDomain: "casa-zapatillas.firebaseapp.com",
  projectId: "casa-zapatillas",
  storageBucket: "casa-zapatillas.appspot.com",
  messagingSenderId: "912547598774",
  appId: "1:912547598774:web:28f3708a71561f3c62b117",
  measurementId: "G-TGGF3N8RTD"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();
provider.setCustomParameters({ prompt: "select_account" });

const googleBtn = document.getElementById("googleLogin");
const loginForm = document.getElementById("formlogin");
const registerForm = document.getElementById("formRegister");
const loginItem = document.getElementById("loginItem");

/* ===== ALERTAS ===== */
function mostrarAlerta(msg, color="green") {
  const toastEl = document.getElementById("alertaAgregado");
  const msgEl = document.getElementById("msgAlerta");
  msgEl.textContent = msg;
  toastEl.style.backgroundColor = color;
  toastEl.style.display="block";
  setTimeout(()=>{ toastEl.style.display="none"; },2000);
}

/* ===== LOGIN GOOGLE ===== */
googleBtn.addEventListener("click", async () => {
  try {
    const result = await signInWithPopup(auth, provider);
    const user = result.user;
    await setDoc(doc(db, "usuarios", user.uid), { uid: user.uid, nombre: user.displayName, email: user.email, foto: user.photoURL }, { merge: true });
    cerrarModalAuth();
    mostrarAlerta("Hola, Bienvenido " + (user.displayName || user.email));
  } catch (err) { mostrarAlerta("Error al iniciar sesi칩n con Google", "red"); console.error(err); }
});

/* ===== REGISTRO EMAIL ===== */
registerForm.addEventListener("submit", async e => {
  e.preventDefault();
  const nombre = regNombre.value.trim();
  const email = regEmail.value.trim();
  const pass = regPassword.value;

  try {
    const cred = await createUserWithEmailAndPassword(auth, email, pass);
    const user = cred.user;
    await setDoc(doc(db, "usuarios", user.uid), {
      uid: user.uid,
      nombre,
      email,
      foto: `https://ui-avatars.com/api/?name=${encodeURIComponent(nombre)}&background=random`
    });
    cerrarModalAuth();
    mostrarAlerta("Registro exitoso. Bienvenido " + nombre);
  } catch (err) { mostrarAlerta("Error en registro: " + err.message, "red"); }
});

/* ===== LOGIN EMAIL ===== */
loginForm.addEventListener("submit", async e => {
  e.preventDefault();
  try {
    const email = loginEmail.value.trim();
    const password = loginPassword.value.trim();
    const cred = await signInWithEmailAndPassword(auth, email, password);
    cerrarModalAuth();
    mostrarAlerta("Hola, Bienvenido " + (cred.user.displayName || email));
  } catch (err) { mostrarAlerta("Usuario o contrase침a incorrecta", "red"); }
});

/* ===== NAVBAR ===== */
function cerrarModalAuth() {
  const modal = bootstrap.Modal.getInstance(document.getElementById("authModal"));
  if (modal) modal.hide();
}

function pintarUsuarioNavbar(user) {
  if (document.getElementById("userinfo")) return;
  const foto = user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.displayName || user.email)}`;
  const nombre = user.displayName || user.email;

  const li = document.createElement("li");
  li.className = "nav-item dropdown ms-3 d-flex align-items-center";
  li.id = "userinfo";
  li.innerHTML = `
    <button class="btn btn-link position-relative me-3 text-white" id="btnCarritoIcono">
      <i class="bi bi-cart3 fs-5 text-white"></i>
      <span id="contadorCarrito" class="badge rounded-pill bg-danger position-absolute top-0 start-100 translate-middle">0</span>
    </button>
    <a class="nav-link dropdown-toggle d-flex align-items-center" data-bs-toggle="dropdown">
      <img src="${foto}" class="rounded-circle me-2" width="32" height="32">
      <span class="text-white">${nombre}</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end">
      <li><a class="dropdown-item" id="misPedidosBtn">Mis pedidos</a></li>
      <li><hr class="dropdown-divider"></li>
      <li><a class="dropdown-item text-danger" id="cerrarSesionBtn">Cerrar sesi칩n</a></li>
    </ul>
  `;
  document.querySelector(".navbar-nav").appendChild(li);

  document.getElementById("cerrarSesionBtn").addEventListener("click", async () => await signOut(auth));
  document.getElementById("misPedidosBtn").addEventListener("click", async () => {
    await cargarPedidosUsuario();
    const modal = new bootstrap.Modal(document.getElementById("modalPedidos"));
    modal.show();
  });

  document.getElementById("btnCarritoIcono").addEventListener("click", () => {
    renderCarrito();
    const modalCarrito = new bootstrap.Modal(document.getElementById("modalCarrito"));
    modalCarrito.show();
  });

  actualizarContador();
}

/* ===== CARRITO ===== */
let carrito = JSON.parse(localStorage.getItem("carrito")) || [];

function actualizarContador() {
  const contador = document.getElementById("contadorCarrito");
  if (contador) contador.textContent = carrito.reduce((acc, p) => acc + (p.cantidad || 1), 0);
}

function renderCarrito() {
  const lista = document.getElementById("listaCarrito");
  lista.innerHTML = "";
  let total = 0;
  carrito.forEach((p, i) => {
    const cantidad = p.cantidad || 1;
    total += p.precio * cantidad;
    const div = document.createElement("div");
    div.className = "d-flex justify-content-between align-items-center border-bottom py-2";
    div.innerHTML = `
      <div class="d-flex align-items-center">
        <img src="${p.img}" width="50" height="50" class="me-2 rounded">
        <span>${p.nombre}</span>
      </div>
      <div class="d-flex align-items-center">
        <button class="btn btn-sm btn-secondary btn-restar me-1" data-index="${i}">-</button>
        <span class="mx-1">${cantidad}</span>
        <button class="btn btn-sm btn-secondary btn-sumar ms-1" data-index="${i}">+</button>
        <span class="fw-bold ms-3">S/ ${(p.precio * cantidad).toFixed(2)}</span>
        <button class="btn btn-sm btn-danger btn-eliminar ms-2" data-index="${i}"><i class="bi bi-trash"></i></button>
      </div>
    `;
    lista.appendChild(div);
  });
  document.getElementById("totalCarrito").textContent = "S/ " + total.toFixed(2);

  document.querySelectorAll(".btn-sumar").forEach(btn => btn.addEventListener("click", () => {
    const i = btn.dataset.index; carrito[i].cantidad++; guardarCarrito();
  }));
  document.querySelectorAll(".btn-restar").forEach(btn => btn.addEventListener("click", () => {
    const i = btn.dataset.index; carrito[i].cantidad--; if(carrito[i].cantidad<=0) carrito.splice(i,1); guardarCarrito();
  }));
  document.querySelectorAll(".btn-eliminar").forEach(btn => btn.addEventListener("click", () => {
    const i = btn.dataset.index; carrito.splice(i,1); guardarCarrito();
  }));
}

function guardarCarrito() {
  localStorage.setItem("carrito", JSON.stringify(carrito));
  renderCarrito(); actualizarContador();
}

/* ===== AGREGAR PRODUCTOS ===== */
document.querySelectorAll(".addToCart").forEach(btn => {
  btn.addEventListener("click", () => {
    const card = btn.closest(".card");
    const nombre = card.querySelector(".card-title").textContent;
    const precio = parseFloat(card.querySelector(".fw-bold").dataset.precio);
    const img = card.querySelector("img").src;
    const exist = carrito.find(p => p.nombre === nombre);
    if(exist) exist.cantidad++; else carrito.push({nombre, precio, img, cantidad:1});
    guardarCarrito();
    mostrarAlerta("Producto agregado al carrito 游");
  });
});

/* ===== PAGAR ===== */
document.getElementById("btnComprar").addEventListener("click", async () => {
  const user = auth.currentUser;
  if(!user){ mostrarAlerta("Debes iniciar sesi칩n para pagar", "red"); return; }
  if(carrito.length ===0){ mostrarAlerta("Tu carrito est치 vac칤o", "red"); return; }
  try{
    await addDoc(collection(db,"Pedidos"),{
      uid:user.uid,
      items:carrito,
      total:carrito.reduce((acc,i)=>acc+i.precio*(i.cantidad||1),0),
      fecha:serverTimestamp()
    });
    mostrarAlerta("Pedido realizado con 칠xito");
    carrito=[]; guardarCarrito();
    bootstrap.Modal.getInstance(document.getElementById("modalCarrito")).hide();
  }catch(err){ mostrarAlerta("Error al realizar el pedido: "+err.message, "red"); }
});

/* ===== PEDIDOS ===== */
async function cargarPedidosUsuario(){
  const user = auth.currentUser;
  if(!user){ mostrarAlerta("Debes iniciar sesi칩n para ver tus pedidos", "red"); return; }
  const q = query(collection(db,"Pedidos"),where("uid","==",user.uid));
  const snapshot = await getDocs(q);
  const lista = document.getElementById("listaPedidos"); lista.innerHTML="";
  if(snapshot.empty){ lista.innerHTML="<p>No tienes pedidos a칰n</p>"; return; }
  snapshot.forEach(docu=>{
    const data = docu.data();
    const div = document.createElement("div");
    div.className="pedido-card";
    div.innerHTML=`
      <div class="pedido-header">Pedido #${docu.id}</div>
      ${data.items.map(item=>`
        <div class="pedido-item">
          <div class="d-flex align-items-center">
            <img src="${item.img}">
            <span>${item.nombre} x${item.cantidad||1}</span>
          </div>
          <span>S/ ${(item.precio*(item.cantidad||1)).toFixed(2)}</span>
        </div>`).join("")}
      <div class="mt-2 fw-bold">Total: S/ ${data.total.toFixed(2)}</div>
    `;
    lista.appendChild(div);
  });
}

/* ===== ESTADO DE SESI칍N ===== */
onAuthStateChanged(auth,user=>{
  if(user){ loginItem.style.display="none"; pintarUsuarioNavbar(user); }
  else{ loginItem.style.display="block"; const info=document.getElementById("userinfo"); if(info) info.remove(); }
});

document.addEventListener("DOMContentLoaded",()=>{ actualizarContador(); });
</script>
</body>
</html>
